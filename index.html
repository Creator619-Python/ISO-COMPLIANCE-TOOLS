<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IMS Compliance Dashboard</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --bg-color: #f8f9fa;
      --text-color: #212529;
      --card-bg: #ffffff;
      --shadow: rgba(0, 0, 0, 0.1);
      --primary: #0d6efd;
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #f8f9fa;
      --card-bg: #1e1e1e;
      --shadow: rgba(255, 255, 255, 0.05);
      --primary: #66b0ff;
    }

    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: "Segoe UI", sans-serif;
      transition: background 0.5s, color 0.5s;
    }

    .title { font-weight: 700; color: var(--primary); }

    .card-summary {
      border-radius: 1rem;
      box-shadow: 0 2px 8px var(--shadow);
      padding: 1rem;
      background: var(--card-bg);
      transition: background 0.5s;
    }

    .btn-standard {
      font-size: 1rem;
      font-weight: 500;
      padding: 1rem;
      border-radius: 1rem;
      box-shadow: 0 2px 6px var(--shadow);
      transition: all 0.3s ease;
    }

    .btn-standard:hover { transform: translateY(-3px); }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: var(--card-bg);
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      box-shadow: 0 2px 8px var(--shadow);
      color: var(--primary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover { transform: rotate(20deg); }
  </style>
</head>

<body>
  <button id="themeToggle" class="theme-toggle" title="Toggle Light/Dark Mode">
    <i class="fas fa-moon"></i>
  </button>

  <div class="container text-center py-5">
    <h1 class="mb-3 title">Integrated Management System (IMS) Compliance Suite</h1>
    <p class="lead mb-4">Track and visualize compliance across all ISO standards.</p>

    <!-- Search -->
    <div class="mb-5" style="max-width:420px;margin:auto;">
      <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="ðŸ” Search for a standard..." />
    </div>

    <!-- IMS Health -->
    <div class="row justify-content-center mb-5">
      <div class="col-md-6">
        <div class="card-summary text-center p-4">
          <h4><i class="fas fa-chart-pie"></i> Overall IMS Health</h4>
          <canvas id="overallPieChart" height="220"></canvas>
          <h3 id="overallIMSScore" class="mt-3 fw-bold"></h3>
          <p id="healthMessage" class="small"></p>
        </div>
      </div>
    </div>

    <!-- Compliance Bar Chart -->
    <div class="row justify-content-center mb-5">
      <div class="col-md-10">
        <div class="card-summary p-4">
          <h4><i class="fas fa-chart-bar"></i> Standard-wise Compliance Overview</h4>
          <canvas id="complianceChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <!-- ISO Grid -->
    <div id="standardsGrid" class="row row-cols-1 row-cols-md-2 g-4"></div>

    <!-- Clause Modal -->
    <div class="modal fade" id="clauseModal" tabindex="-1" aria-labelledby="clauseModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="clauseModalLabel" class="modal-title">Clauses</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="clauseContainer"></div>
        </div>
      </div>
    </div>

    <footer class="mt-5">
      <p>Developed independently by <strong>Gokul T.B</strong> | IMS Compliance Tools Â© 2025</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const standards = [
      { name: "ISO 9001:2015 â€“ Quality Management", folder: "ISO-9001-2015", color: "primary" },
      { name: "ISO 14001:2015 â€“ Environmental Management", folder: "ISO-14001-2015", color: "success" },
      { name: "ISO 45001:2018 â€“ Occupational Health & Safety", folder: "ISO-45001-2018", color: "danger" },
      { name: "ISO 31000:2018 â€“ Risk Management", folder: "ISO-31000-2018", color: "secondary" },
      { name: "ISO 22301:2019 â€“ Business Continuity", folder: "ISO-22301-2019", color: "info" },
      { name: "ISO 27001:2022 â€“ Information Security", folder: "ISO-27001-2022", color: "dark" },
      { name: "ISO 50001:2018 â€“ Energy Management", folder: "ISO-50001-2018", color: "warning" },
      { name: "ISO 26000:2010 â€“ Social Responsibility", folder: "ISO-26000-2010", color: "outline-primary" },
    ];

    const grid = document.getElementById("standardsGrid");

    // === Search Filter ===
    document.getElementById("searchInput").addEventListener("keyup", e => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll(".standard-card").forEach(card => {
        card.style.display = card.dataset.name.includes(q) ? "block" : "none";
      });
    });

    // === Load JSON and Calculate Compliance ===
    fetch("./Merged_ISO_Clauses.json")
      .then(res => res.json())
      .then(json => {
        const data = json.Merged_Standards || [];
        const scores = {};

        // Group clauses by ISO
        standards.forEach(std => {
          const code = std.folder.match(/\d{4,5}/)[0];
          const clauses = data.filter(c => c.Standard && c.Standard.includes(code));

          if (clauses.length > 0) {
            const compliant = clauses.filter(c => c.Compliance === "compliant").length;
            const partial = clauses.filter(c => c.Compliance === "partial").length;
            const total = clauses.length;
            const percent = Math.round(((compliant + partial * 0.5) / total) * 100);
            scores[std.name] = percent;
          } else {
            scores[std.name] = null;
          }

          // Add to grid
          const div = document.createElement("div");
          div.className = "col standard-card";
          div.dataset.name = std.name.toLowerCase();
          div.innerHTML = `
            <a href="./${std.folder}/" class="btn btn-${std.color} w-100 btn-standard">
              <i class="fas fa-certificate"></i> ${std.name}
              <div class="small mt-2">Compliance: ${scores[std.name] ?? "--"}%</div>
            </a>
            <button class="btn btn-outline-secondary mt-2 w-100" onclick="showClauses('${std.name}')">
              <i class="fas fa-book-open"></i> View Clauses
            </button>
          `;
          grid.appendChild(div);
        });

        drawCharts(scores);
      });

    // === Charts ===
    function drawCharts(scores) {
      const validScores = Object.values(scores).filter(v => v !== null);
      const avg = validScores.length ? Math.round(validScores.reduce((a,b)=>a+b,0)/validScores.length) : 0;

      const color = avg >= 80 ? "#28a745" : avg >= 50 ? "#ffc107" : "#dc3545";
      document.getElementById("overallIMSScore").innerHTML = `<span style="color:${color}">${avg}%</span>`;
      document.getElementById("healthMessage").textContent =
        avg >= 80 ? "Excellent IMS health â€“ well integrated." :
        avg >= 50 ? "Moderate IMS health â€“ needs improvement." :
        "IMS health below optimal â€“ attention required.";

      const pieCtx = document.getElementById("overallPieChart").getContext("2d");
      const barCtx = document.getElementById("complianceChart").getContext("2d");

      new Chart(pieCtx, {
        type: "doughnut",
        data: { labels: ["Compliant", "Pending"], datasets: [{ data: [avg, 100-avg], backgroundColor: [color, "#e9ecef"] }] },
        options: { cutout: "70%", plugins: { legend: { display: false } } }
      });

      new Chart(barCtx, {
        type: "bar",
        data: {
          labels: Object.keys(scores),
          datasets: [{ label: "Compliance %", data: Object.values(scores),
            backgroundColor: Object.values(scores).map(v => v>=80?"#28a745":v>=50?"#ffc107":"#dc3545") }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } }, plugins: { legend: { display: false } } }
      });
    }

    // === Show Clauses ===
    async function showClauses(stdName) {
      const res = await fetch("./Merged_ISO_Clauses.json");
      const json = await res.json();
      const data = json.Merged_Standards || [];
      const code = stdName.match(/\d{4,5}/)[0];
      const clauses = data.filter(c => c.Standard && c.Standard.includes(code));
      const modalLabel = document.getElementById("clauseModalLabel");
      const container = document.getElementById("clauseContainer");

      modalLabel.textContent = stdName;
      if (!clauses.length) { container.innerHTML = `<p>No clauses found.</p>`; }
      else {
        container.innerHTML = clauses.map((c,i)=>`
          <div class="accordion mb-2">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#cl-${i}">
                  Clause ${c.Clause}: ${c.Title || "Untitled"}
                </button>
              </h2>
              <div id="cl-${i}" class="accordion-collapse collapse">
                <div class="accordion-body text-start">
                  <p><strong>Purpose:</strong> ${c.Purpose || "-"}</p>
                  <p><strong>Evidence:</strong> ${c.Evidence || "-"}</p>
                  <p><strong>Integration:</strong> ${c.Integration || "-"}</p>
                  <p><strong>Example:</strong> ${c.Example || "-"}</p>
                </div>
              </div>
            </div>
          </div>`).join("");
      }

      new bootstrap.Modal(document.getElementById("clauseModal")).show();
    }

    // === Theme Toggle ===
    const toggle = document.getElementById("themeToggle");
    toggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      toggle.innerHTML = document.body.classList.contains("dark-mode")
        ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    });
  </script>
</body>
</html>
